# 設計取捨與擴充路線（我為什麼這樣選）

你提出的核心限制是：**中小學人力不足、預算有限、但資料結構要正確且可擴充**。因此設計時我優先把「未來最難補救的決策」先定好（資料模型、邊界、權限、稽核、多租戶），而不是先把 UI 做漂亮。

## 1) 為什麼先做「模組化單體」而不是微服務？
微服務在大型團隊很有價值，但也有成本：部署、監控、跨服務交易、一堆基礎建設。

對你目前的情境（學生專案 → MVP → 逐步擴充）：
- **模組化單體（Modular Monolith）**能用最少成本達到清楚邊界與可維運性。
- 未來若真的要拆（例如把搜尋/報表/通知拆出去），因為我們先把模組邊界定好，拆分會更平滑。

對應文件：`ARCHITECTURE.md`

## 2) 為什麼主語言選 TypeScript？
目標不是「語言最強」，而是「讓你能在有限時間內做出可維運的系統」：
- 前後端同語言：降低上下文切換成本
- 型別可共享：降低 API 契約不一致的 bug
- 生態完整：Web/API/工具鏈成熟

替代方案與取捨（簡述）：
- Python/Django：開發快，但前後端型別一致性要靠額外工具；你也會遇到前端學習成本。
- Java/Spring：結構強，但入門與樣板成本較高，對 MVP 速度不利。
- PHP/Laravel：生態成熟，但同樣面臨前端型別對齊問題（可解，但要多套工具）。

## 3) 為什麼先把多租戶（organization_id）放進去？
「單校 → 多校」是常見擴充方向（你未來若要推廣或做 demo 給不同學校）。
如果一開始不做多租戶，之後補上去通常要：
- 改所有表、改所有查詢、補資料遷移、補權限隔離

因此我們在 `DATA-DICTIONARY.md` 與 `db/schema.sql` 直接納入：
- `organizations`
- 幾乎所有資料表都有 `organization_id`

## 4) 為什麼資料模型要「書目 vs 冊」分離？
這是圖資系統的核心正規化：
- **書目（Bibliographic Record）**：描述「這本書是什麼」（書名、作者、ISBN、主題、分類）
- **冊（Item/Copy）**：描述「這一冊在哪裡、可不可以借」（條碼、索書號、位置、狀態）

分離的好處：
- 一本書多冊不會變成資料重複
- 借還只操作冊，避免邏輯錯亂
- 報表可以同時做「書目層」與「冊層」分析

## 5) 為什麼借還要用動作端點（checkout/checkin）？
借還是「跨多表的一次性交易」：
- 借出要同時：建立 loan、更新 item 狀態、寫 audit、套用政策
- 歸還要同時：關閉 loan、更新 item 狀態、可能觸發 hold

如果用 `PATCH /items/{id}` 讓前端自己改狀態：
很容易出現「loan 和 item 狀態不同步」的資料腐敗。

因此在 `API-DRAFT.md` 我用動作端點集中流程，並要求後端用 transaction 保證一致性。

## 6) 為什麼把「逾期」設計成可推導，而不是存一個狀態？
逾期其實是：
- `returned_at IS NULL` 且 `due_at < now()`

如果把逾期存成狀態，會遇到：
- 需要排程每天更新狀態
- 如果排程失敗，狀態就錯

所以在 `db/schema.sql` 裡，loan 的狀態只分 `open/closed`；逾期用查詢條件推導，資料更穩定。

## 7) 為什麼預設「不做罰款」且借閱歷史保存保守？
校園情境常見：
- 沒有人力逐筆對帳與收費
- 罰款處理容易引發行政成本與爭議

因此 MVP 政策採：
- 逾期提醒 + 停權（禁止新增借閱）為主
- 借閱歷史保存採最小化（詳細策略可在 J 章與後續文件補強）

## 8) 擴充路線（建議順序）
1. **通知系統**：先做「匯出名單」→ 再做 Email/LINE（需要學校政策與通訊管道）
2. **批次匯入/ISBN 補齊**：降低建檔成本（可能需要外部資料源/介接）
3. **盤點與異常偵測**：提升資料品質與館藏可用性
4. **SSO/名冊同步**：若學校 IT 成熟，再做校務系統整合
5. **進階檢索**：資料量大或需求複雜時再上專用搜尋引擎

## 9) 我如何把「可學習」納入設計？
你不熟 TS/Next/Nest，所以我刻意先做：
- 清楚的文件鏈：spec → stories → API → data dictionary → schema
- 最小可跑骨架：API 先有 `/health`，Web 先有首頁
- 可擴充但不過度：先用 Postgres + schema.sql，未來再導入 Prisma migrations

你每做完一個 epic，就會同時學到：
- 前端怎麼呼叫 API
- 後端怎麼做驗證、交易、權限
- DB constraint 怎麼幫你保資料正確

